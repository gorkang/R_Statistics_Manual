# Visualizar datos{#Visualizar_datos}

## TODO

* Some interesting simple ideas here http://pythonplot.com/
* **TABLA RESUMEN CON IMAGENES DE GRAFICAS**

WHY Data visualization matters: https://www.autodeskresearch.com/publications/samestats

***  

Vamos a usar la siguiente [base de datos](Data/06_Visualize_data/Visualize_data.csv).

***


R es un lenguaje especialmente potente para la visualización de datos. Librerias como ggplot2 permiten una cantidad abrumadora de opciones. Aqui presentamos ejemplos de algunas de las posibilidades de R. 

## Que gráfica puedo usar (WIP)


![](Images/coggleviz.png)
* Image FROM [Modern Dive](https://ismayc.github.io/moderndiver-book/4-viz.html#resources)

DV/IV           | IV continua                   | IV vategórica       | IV dicotómica
-------------   | -------------                 | -------------       | ------------- 
DV continua     | ^SCATTER^ ^PIRATE^ ^CORREL^   | ^PIRATE^ ^CAJA^     | ^BEAN^ ^DENSITY^ ^PIRATE^ 
DV categórica   | ...                           | ^PIRATE^            | ... 
DV dicotómica   | ...                           | ...                 | ...


* Cargamos librerias y leemos datos
```{r, message=FALSE, warning=FALSE}
# Cargamos librerias
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(tidyverse, yarrr)  
    
# Leemos datos y echamos un vistazo
datos = read_csv("Data/06_Visualize_data/Visualize_data.csv"); datos  
  
# A algunas de las funciones no les gustan las tibbles! 
datos2 = read.csv("Data/06_Visualize_data/Visualize_data.csv") 

```

* Nota sobre sintaxis

En muchos de los gráficos, análisis estadísticos, etc, usaremos la sintaxis: `Var_Dep ~ Var_Indep_1 + Var_Indep_2`  


## Tipos de gráficas

### Histogramas

La función hist() nos permite crear de manera muy sencilla histogramas para ver 
```{r}
# Histograma sencillo
hist(datos$Edad)

# Dotplot histogram
qplot(datos$Edad, 
      geom="dotplot", 
      fill = I("forestgreen"),
      xlab = "Age", 
      main = "Age dotplot histogram")

```

Si queremos ver los histogramas de todas las variables numéricas de nuestro dataset:
```{r}
# Metodo 1
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(plyr, psych)
# multi.hist(datos) #error, not numeric
multi.hist(datos[,sapply(datos, is.numeric)])

# Metodo 2
p_load(reshape2, ggplot2)
d <- melt(datos)
ggplot(d,aes(x = value)) + 
    facet_wrap(~variable,scales = "free_x") + 
    geom_histogram(bins = 15) #+ coord_cartesian(ylim = c(0, 100))

```


### Pirate plot{#Pirate-Plot}

Ver la web del creador: [Pirate plot](http://nathanieldphillips.com/) y su página de [Github](https://github.com/ndphillips/yarrr)
```{r}
# Cargamos librerias
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(yarrr)
    
# Mostramos gráfico con opciones por defecto
pirateplot(formula = PPV_DECLARED ~ condition, datos)

# Personalizamos el gráfico
pirateplot(formula = PPV_DECLARED ~ condition,
           data = datos,
           main = "PPV by condition",
           avg.line.fun = median,
           #theme.o = 2,
           jitter.val = .2,
           inf.method = "ci", #Show confidence interval (95%)
           inf.f.o = 0.2, #Opacity of ci
           pal = "appletv")
```

### Diagrama de caja y bigotes

```{r}
boxplot(PPV_DECLARED ~ condition, datos)
```


### Correlation plot

Ver la web del paquete: [Correlation plot](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html) y su página de [Github](https://github.com/taiyun/corrplot)

```{r}
# Cargamos libreria
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(corrplot)

corrplot(cor(datos[,c(2:5,7)]), mar = c(1,0, 0, 0),tl.cex = 0.9, 
         method = "square", type = "lower", tl.col = "black", diag = T)
```

### Beanplot

Ver la web del paquete [Beanplot](https://cran.r-project.org/web/packages/beanplot/index.html)

```{r}
# Cargamos libreria
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(beanplot)
    
beanplot(FollowUP ~ Genero, data = datos,  side = "both", log = "", names = c("Hombre","Mujer"),
what = c(1,1,1,0), border = NA, col = list("black", c("grey", "white")))
# legend("bottomleft", fill = c("black", "grey"), legend = c("H", "M"), title = "Genero")

```

### Scatterplot

Ver la web del creador: [ggpubr](http://www.sthda.com/english/rpkgs/ggpubr/) y su página de [Github](https://github.com/kassambara/ggpubr)
```{r}
# Cargamos libreria
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(ggpubr)

ggscatter(datos2, x = "Educacion", y = "Edad",
   color = "black", shape = 21, size = 4, # Points color, shape and size
   add = "reg.line",  # Add regressin line
   add.params = list(color = "blue", fill = "lightgray"), # Customize reg. line
   conf.int = TRUE, # Add confidence interval
   cor.coef = TRUE # Add correlation coefficient
   )
```

### Scatterplot con 3 variables

Ver la web de documentación de [ggplot2](http://docs.ggplot2.org/current/) y su página de [Github](https://github.com/hadley/ggplot2)

```{r}
# Cargamos libreria
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(tidyverse)

ggplot(datos, aes(PPV_DECLARED, FollowUP, color=factor(Genero))) +
    geom_point(shape=1, size = 2) +
    scale_colour_hue(l=50) + # Palette hue
    geom_smooth(method=lm,   # Linear regression lines
                se=T,        # Confidence interval
                fullrange=F) # Extend regression lines
```

### Multiple Scatterplots

```{r}
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(tidyverse, ggthemes, Rmisc)

a = read_csv("Data/06_Visualize_data/data_multiple_scatterplot.csv")

# Si se cambia alguno de estos nombres, cambiar tb abajo (o mejor, find and replace all!)
colnames(a) = c("a", "Executive functions", "Emotional recognition", "ToM", "Inhibitory verbal control", "Cryst. Intellig. (vocab)", "Cryst. Intellig. (years of education)", "Fluid intelligence", "w", "gg")


p1 = ggplot(a, aes(x = `Cryst. Intellig. (vocab)`, y = `Executive functions`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank())

p2 = ggplot(a, aes(x = `Cryst. Intellig. (vocab)`, y = `Emotional recognition`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank())

p3 = ggplot(a, aes(x = `Cryst. Intellig. (vocab)`, y = ToM)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte()  + theme(axis.title.x=element_blank())

p4 = ggplot(a, aes(x = `Cryst. Intellig. (vocab)`, y = `Inhibitory verbal control`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() 

p5 = ggplot(a, aes(x = `Cryst. Intellig. (years of education)`, y = `Executive functions`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p6 = ggplot(a, aes(x = `Cryst. Intellig. (years of education)`, y = `Emotional recognition`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p7 = ggplot(a, aes(x = `Cryst. Intellig. (years of education)`, y = ToM)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p8 = ggplot(a, aes(x = `Cryst. Intellig. (years of education)`, y = `Inhibitory verbal control`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.y=element_blank())

p9 = ggplot(a, aes(x = `Fluid intelligence`, y = `Executive functions`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p10 = ggplot(a, aes(x = `Fluid intelligence`, y = `Emotional recognition`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p11 = ggplot(a, aes(x = `Fluid intelligence`, y = ToM)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.x=element_blank(), axis.title.y=element_blank())

p12 = ggplot(a, aes(x = `Fluid intelligence`, y = `Inhibitory verbal control`)) + geom_point(shape=16, fill="darkgrey", color="black", size=2) +
  geom_smooth(method=lm, fill="grey", color="black", se = F, size = .5) + theme_tufte() + theme(axis.title.y=element_blank())


multiplot(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, cols=3)

```


### Density plots

Ver la web del creador: [ggpubr](http://www.sthda.com/english/rpkgs/ggpubr/) y su página de [Github](https://github.com/kassambara/ggpubr)

* The variable we use to create two different sub-plots has to be a factor!  

```{r}
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(tidyverse, ggpubr)

datos = read_csv("Data/06_Visualize_data/Visualize_data.csv")

datos = datos %>% 
  mutate(Genero = as.factor(unlist(Genero))) %>% #Make Genero a factor
  mutate(PPV_DECLARED = as.numeric(unlist(PPV_DECLARED)))

ggdensity(datos, x = "PPV_DECLARED",
   add = "mean", rug = TRUE,
   color = "Genero", palette = c("#00AFBB", "#E7B800"), fill = "Genero")

```

### ggjoy Plots

```{r}
if (!require('pacman')) install.packages('pacman'); library('pacman')
p_load(tidyverse, ggridges)

datos2 = datos %>% drop_na() %>% 
  filter(Educacion < 8) %>% 
  mutate(Educacion = as.factor(Educacion)) %>% 
  mutate(PPV_DECLARED = as.double(PPV_DECLARED))

# datos2 %>% group_by(Genero) %>% dplyr::summarise(N = n())

# Simple version
ggplot(datos2, aes(x = FollowUP, y = Genero)) + 
  geom_density_ridges(scale = 2)

# Tweak some aesthetics 
ggplot(datos2, aes(x = FollowUP, y = Genero, fill = Genero)) + 
  geom_density_ridges(scale = 2, alpha = .7, color = "white") + 
  scale_fill_hue(l=30)

# Histogram stat
ggplot(datos2, aes(x = FollowUP, y = Genero, fill = Genero)) + 
  geom_density_ridges(scale = 2, alpha = .7, color = "white", stat = "binline", bins = 20) + 
  scale_fill_hue(l=30)

# Combined
ggplot(datos2, aes(x = FollowUP, y = Genero, fill = Genero)) + 
  geom_density_ridges(scale = 2, alpha = .7, color = "white", stat = "binline", bins = 20) + 
  geom_density_ridges(scale = 2, alpha = .4, color = "white") + 
  scale_fill_hue(l=30)
```

